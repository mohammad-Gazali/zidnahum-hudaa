<mat-radio-group [class.hidden]="studentResponse() || categoryOrGroupResponse()" [formControl]="type">
    <mat-radio-button value="student">طالب</mat-radio-button>
    <mat-radio-button value="category">فئة</mat-radio-button>
    <mat-radio-button value="group">مجموعة</mat-radio-button>
</mat-radio-group>
<form [class.hidden]="studentResponse() || categoryOrGroupResponse()" [formGroup]="form" (ngSubmit)="submit()">
    @switch (type.value) {
        @case ('student') {
            <app-student-search
            (studentChoose)="selectedStudent.set($event)"
            [removeResultOnChoose]="true"
            ></app-student-search>
            @if (selectedStudent(); as student) {
                <div class="chips-container">
                    <mat-chip-row (removed)="removeStudent()">
                        {{ student.id }} - {{ student.name }}
                        <button matChipRemove>
                            <mat-icon>close</mat-icon>
                        </button>
                    </mat-chip-row>    
                </div>
            }
    
        } @case ('category') {
            @if (categories(); as categories) {
                <mat-form-field>
                    <mat-label>الفئة</mat-label>
                    <mat-select [formControl]="form.controls.category">
                        @for (category of categories; track category.id) {
                            <mat-option [value]="category.id">
                                {{ category.name }}
                            </mat-option>
                        }
                    </mat-select>
                    <mat-error>{{ 'this field is required' | translate }}</mat-error>
                </mat-form-field>
            }
    
        } @case ('group') {
            @if (groups(); as groups) {
                <mat-form-field>
                    <mat-label>المجموعة</mat-label>
                    <mat-select [formControl]="form.controls.group">
                        @for (group of groups; track group.id) {
                            <mat-option [value]="group.id">
                                {{ group.name }}
                            </mat-option>
                        }
                    </mat-select>
                    <mat-error>{{ 'this field is required' | translate }}</mat-error>
                </mat-form-field>
            }
    
        }
    }
    @if (type.value !== 'student') {
        <mat-form-field>
            <mat-label>المسجد</mat-label>
            <mat-select [formControl]="form.controls.masjed">
                @if (masjeds(); as masjeds) {
                    @for (masjed of masjeds; track masjed.id) {
                        <mat-option [value]="masjed.id">
                            {{ masjed.name }}
                        </mat-option>
                    }
                }
            </mat-select>
            <mat-error>{{ 'this field is required' | translate }}</mat-error>
        </mat-form-field>
    }
    <mat-form-field>
        <mat-label>فترة التقرير</mat-label>
        <mat-date-range-input [rangePicker]="rangePicker">
            <input [formControl]="form.controls.start_date" matStartDate placeholder="تاريخ البداية">
            <input [formControl]="form.controls.end_date" matEndDate placeholder="تاريخ النهاية">
        </mat-date-range-input>
        <mat-date-range-picker #rangePicker></mat-date-range-picker>
        <mat-datepicker-toggle matIconSuffix [for]="rangePicker"></mat-datepicker-toggle>
        <mat-hint>ملاحظة: وقت النهاية غير مضمن</mat-hint>
        <mat-error>{{ 'this field is required' | translate }}</mat-error>
    </mat-form-field>
    <button [disabled]="loading()" mat-flat-button color="primary">
        إنشاء التقرير
    </button>
</form>
<mat-table class="hidden">
    <mat-header-row *matHeaderRowDef="[]"></mat-header-row>
</mat-table>
@if (studentResponse(); as response) {
    <button mat-flat-button color="accent" (click)="submit(true)">
        التصدير إلى إكسل
    </button>
    <div class="responsive-container mat-elevation-z8">
        <table class="mat-mdc-table mdc-data-table__table">
            <thead role="rowgroup">
                <tr class="mat-mdc-header-row">
                    <th class="mat-mdc-header-cell mdc-data-table__header-cell">المعرف</th>
                    <th class="mat-mdc-header-cell mdc-data-table__header-cell">الأستاذ</th>
                    <th class="mat-mdc-header-cell mdc-data-table__header-cell">المحتوى</th>
                    <th class="mat-mdc-header-cell mdc-data-table__header-cell">نوع الرسالة</th>
                    <th class="mat-mdc-header-cell mdc-data-table__header-cell">تاريخ الإرسال</th>
                    <th class="mat-mdc-header-cell mdc-data-table__header-cell">قيمة مضاعفة</th>
                </tr>
            </thead>
            <tbody class="mdc-data-table__content" role="rowgroup">
                @for (message of response.messages; track message.id) {
                    <tr class="mat-mdc-row">
                        <td class="mat-mdc-cell mdc-data-table__cell">{{ message.id }}</td>
                        <td class="mat-mdc-cell mdc-data-table__cell">{{ masterMap().get(message.master) }}</td>
                        <td class="mat-mdc-cell mdc-data-table__cell">{{ message.changes }}</td>
                        <td class="mat-mdc-cell mdc-data-table__cell">{{ messageTypeMap().get(message.message_type ?? 1) }}</td>
                        <td class="mat-mdc-cell mdc-data-table__cell">{{ message.sended_at | date: 'yyyy/MM/dd hh:mm a' }}</td>
                        <td class="mat-mdc-cell mdc-data-table__cell">{{ message.is_doubled }}</td>
                    </tr>
                } @empty {
                    <tr class="mat-mdc-row">
                        <td class="mat-mdc-cell no-data-row" [attr.colspan]="6">
                            <div>
                              {{ 'there is no data' | translate }}
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
    <ul>
        <li>صفحات التسميع: {{ response.sum_memo }}</li>
        <li>صفحات السبر: {{ response.sum_test }}</li>
        <li>كلي الصفحات: {{ response.sum_all }}</li>
    </ul>
}

@if (categoryOrGroupResponse(); as response) {

}