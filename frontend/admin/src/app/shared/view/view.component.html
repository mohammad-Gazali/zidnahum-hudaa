@if (config.editable) {
    <button [color]="editMode() ? 'primary' : 'accent'" class="mode-action-button" mat-fab (click)="toggleMode()">
        <mat-icon [class.hidden]="editMode()">edit</mat-icon>
        <mat-icon [class.hidden]="!editMode()">info</mat-icon>
    </button>
}
<form [formGroup]="form" class="fields-container">    
    @for (field of fields(); track field.name) {
        <div class="field-row">
            <div class="row-title">
                <span>
                    {{ field.name | translate }}
                </span>
            </div>
            @if (field.type === 'string' || field.type === 'number' || field.type === 'boolean') {
                <span [class.hidden]="editMode() && field.name !== 'id'">
                    {{ field.value ?? '-' }}
                </span>
                <mat-form-field [class.hidden]="!editMode() || field.name === 'id' || field.type !== 'string'" appearance="outline">
                    <mat-label>{{ field.name | translate }}</mat-label>
                    <input matInput [formControlName]="field.name" />
                    @if (form.getError('required', field.name)) {
                        <mat-error>{{ 'this field is required' | translate }}</mat-error>
                    }
                </mat-form-field>
                <mat-form-field [class.hidden]="!editMode() || field.name === 'id' || field.type !== 'number'" appearance="outline">
                    <mat-label>{{ field.name | translate }}</mat-label>
                    <input matInput type="number" [formControlName]="field.name" />
                    @if (form.getError('min', field.name)) {
                        <mat-error>{{ 'the minimum value is' | translate }} {{ $any(form.get(field.name)?.errors).min.min }}</mat-error>
                    }
                    @if (form.getError('max', field.name)) {
                        <mat-error>{{ 'the maximum value is' | translate }} {{ $any(form.get(field.name)?.errors).max.max }}</mat-error>
                    }
                </mat-form-field>
                <mat-checkbox [class.hidden]="!editMode() || field.type !== 'boolean'" [formControlName]="field.name"></mat-checkbox>
            } @else if (field.type === 'date' || field.type === 'datetime') {
                <span [class.hidden]="editMode()" dir="ltr">
                    {{ field.value?.replaceAll('-', '/') || '-' }}
                </span>
                <mat-form-field [class.hidden]="!editMode()" appearance="outline">
                    <mat-label>{{ field.name | translate }}</mat-label>
                    <input matInput [matDatepicker]="picker" [formControlName]="field.name">
                    <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-datepicker #picker></mat-datepicker>
                </mat-form-field>
            } @else if (field.type === 'relation') {
                @if (extraData[field.name].getUrlFunc !== undefined && field.value !== null) {
                    <a class="primary" [class.hidden]="editMode()" routerLink="{{ extraData[field.name].getUrlFunc!(field.value) }}">
                        {{ extraData[field.name].map.get(field.value) ?? '-' }}
                    </a>
                } @else {
                    <span [class.hidden]="editMode()">
                        {{ extraData[field.name].map.get(field.value) ?? '-' }}
                    </span>
                }
                <mat-form-field [class.hidden]="!editMode()" appearance="outline">
                    <mat-select [formControlName]="field.name">
                        @if (field.nullable) {
                            <mat-option [value]="null">
                                ({{ 'empty value' | translate }})
                            </mat-option>
                        }
                        @for (item of extraData[field.name].data(); track item.id) {
                            <mat-option [value]="item.id">
                                {{ item.name }}
                            </mat-option>
                        }
                    </mat-select>
                </mat-form-field>
            } @else if (field.type === 'custom') {
                TODO
            }
        </div>
        @if (!$last) {
            <mat-divider></mat-divider>
        }
    }
</form>
